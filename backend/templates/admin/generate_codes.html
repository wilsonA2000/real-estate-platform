{% extends 'base.html' %}
{% load static %}

{% block title %}Generar Códigos de Entrevista - VeriHome{% endblock %}

{% block extra_css %}
<style>
    .form-container {
        background-color: #1F2937;
        border-radius: 0.5rem;
        padding: 2rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    
    .form-group {
        margin-bottom: 1.5rem;
    }
    
    .form-label {
        display: block;
        color: #E5E7EB;
        font-weight: 600;
        margin-bottom: 0.5rem;
    }
    
    .form-control {
        width: 100%;
        padding: 0.75rem;
        background-color: #374151;
        border: 1px solid #4B5563;
        border-radius: 0.375rem;
        color: #E5E7EB;
        transition: border-color 0.2s ease;
    }
    
    .form-control:focus {
        outline: none;
        border-color: #F59E0B;
        box-shadow: 0 0 0 2px rgba(245, 158, 11, 0.2);
    }
    
    .form-help {
        color: #9CA3AF;
        font-size: 0.875rem;
        margin-top: 0.25rem;
    }
    
    .submit-button {
        background-color: #F59E0B;
        color: white;
        padding: 0.75rem 1.5rem;
        border-radius: 0.375rem;
        font-weight: 600;
        transition: background-color 0.2s ease;
        border: none;
        cursor: pointer;
        width: 100%;
    }
    
    .submit-button:hover {
        background-color: #D97706;
    }
    
    .back-link {
        display: inline-flex;
        align-items: center;
        color: #E5E7EB;
        font-weight: 600;
        margin-bottom: 1rem;
        transition: color 0.2s ease;
    }
    
    .back-link:hover {
        color: #F59E0B;
    }
    
    .back-icon {
        margin-right: 0.5rem;
    }
    
    .codes-list {
        margin-top: 2rem;
        background-color: #1F2937;
        border-radius: 0.5rem;
        padding: 1.5rem;
    }
    
    .code-item {
        background-color: #374151;
        border-radius: 0.375rem;
        padding: 1rem;
        margin-bottom: 0.75rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .code-text {
        font-family: monospace;
        font-size: 1.125rem;
        color: #F59E0B;
        font-weight: 600;
    }
    
    .code-type {
        background-color: #4B5563;
        color: #E5E7EB;
        padding: 0.25rem 0.5rem;
        border-radius: 0.25rem;
        font-size: 0.75rem;
        font-weight: 600;
    }
    
    .copy-btn {
        background-color: #4B5563;
        color: #E5E7EB;
        border: none;
        border-radius: 0.25rem;
        padding: 0.25rem 0.5rem;
        cursor: pointer;
        transition: background-color 0.2s ease;
        display: flex;
        align-items: center;
    }
    
    .copy-btn:hover {
        background-color: #6B7280;
    }
    
    .copy-icon {
        margin-right: 0.25rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <a href="{% url 'admin_dashboard' %}" class="back-link">
        <i class="ri-arrow-left-line back-icon"></i> Volver al Panel de Administración
    </a>
    
    <h1 class="text-3xl font-bold text-white mb-6">Generar Códigos de Entrevista</h1>
    
    <div class="form-container">
        <form method="post">
            {% csrf_token %}
            
            <div class="form-group">
                <label for="{{ form.profile_type.id_for_label }}" class="form-label">{{ form.profile_type.label }}</label>
                {{ form.profile_type }}
                {% if form.profile_type.help_text %}
                    <div class="form-help">{{ form.profile_type.help_text }}</div>
                {% endif %}
                {% if form.profile_type.errors %}
                    <div class="text-red-500 text-sm mt-1">{{ form.profile_type.errors }}</div>
                {% endif %}
            </div>
            
            <div class="form-group">
                <label for="{{ form.quantity.id_for_label }}" class="form-label">{{ form.quantity.label }}</label>
                {{ form.quantity }}
                {% if form.quantity.help_text %}
                    <div class="form-help">{{ form.quantity.help_text }}</div>
                {% endif %}
                {% if form.quantity.errors %}
                    <div class="text-red-500 text-sm mt-1">{{ form.quantity.errors }}</div>
                {% endif %}
            </div>
            
            <div class="form-group">
                <label for="{{ form.rating.id_for_label }}" class="form-label">{{ form.rating.label }}</label>
                {{ form.rating }}
                {% if form.rating.help_text %}
                    <div class="form-help">{{ form.rating.help_text }}</div>
                {% endif %}
                {% if form.rating.errors %}
                    <div class="text-red-500 text-sm mt-1">{{ form.rating.errors }}</div>
                {% endif %}
            </div>
            
            <div class="form-group">
                <label for="{{ form.notes.id_for_label }}" class="form-label">{{ form.notes.label }}</label>
                {{ form.notes }}
                {% if form.notes.help_text %}
                    <div class="form-help">{{ form.notes.help_text }}</div>
                {% endif %}
                {% if form.notes.errors %}
                    <div class="text-red-500 text-sm mt-1">{{ form.notes.errors }}</div>
                {% endif %}
            </div>
            
            <button type="submit" class="submit-button">
                <i class="ri-key-line mr-2"></i> Generar Códigos
            </button>
        </form>
    </div>
    
    {% if generated_codes %}
    <div class="codes-list">
        <h2 class="text-xl font-bold text-white mb-4">Códigos Generados</h2>
        <p class="text-gray-400 mb-4">Se han generado {{ generated_codes|length }} códigos. Puedes copiarlos y compartirlos con los usuarios.</p>
        
        <div class="space-y-2">
            {% for code in generated_codes %}
            <div class="code-item">
                <div class="flex items-center">
                    <span class="code-text">{{ code.code }}</span>
                    <span class="code-type ml-3">{{ code.get_profile_type_display }}</span>
                </div>
                <button class="copy-btn" onclick="copyToClipboard('{{ code.code }}')">
                    <i class="ri-file-copy-line copy-icon"></i> Copiar
                </button>
            </div>
            {% endfor %}
        </div>
        
        <div class="mt-4 flex justify-end">
            <a href="{% url 'admin:real_estate_auth_interviewcode_changelist' %}" class="bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-500 flex items-center">
                <i class="ri-list-check mr-2"></i> Ver todos los códigos
            </a>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    function copyToClipboard(text) {
        navigator.clipboard.writeText(text).then(function() {
            // Mostrar mensaje de éxito
            const button = event.target.closest('button');
            const originalText = button.innerHTML;
            button.innerHTML = '<i class="ri-check-line copy-icon"></i> Copiado';
            button.style.backgroundColor = '#10B981';
            
            setTimeout(function() {
                button.innerHTML = originalText;
                button.style.backgroundColor = '';
            }, 2000);
        }, function() {
            // Mostrar mensaje de error
            alert('No se pudo copiar el código. Por favor, inténtalo de nuevo.');
        });
    }
</script>
{% endblock %}