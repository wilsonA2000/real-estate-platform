{% extends 'base.html' %}
{% load widget_tweaks %}
{% load static %}

{% block title %}Lista de Propiedades - VeriHome{% endblock %}

{% block content %}
    <!-- Mensajes de Éxito/Error -->
    {% if messages %}
        <div class="container mx-auto px-4 py-4">
            {% for message in messages %}
                <div class="rounded-lg p-4 mb-4 {% if message.tags == 'success' %}bg-green-50 text-green-800{% else %}bg-red-50 text-red-800{% endif %}">
                    {{ message }}
                </div>
            {% endfor %}
        </div>
    {% endif %}

    <!-- Page Header -->
    <div class="pt-24 pb-12 bg-gradient-to-r from-primary to-amber-400">
        <div class="container mx-auto px-4">
            <h1 class="montserrat text-4xl font-bold text-white text-center">Explora Nuestras Propiedades</h1>
            <p class="text-white text-center mt-4 max-w-2xl mx-auto">Encuentra el hogar perfecto para ti en nuestra comunidad inmobiliaria confiable.</p>
        </div>
    </div>

    <!-- Filtros -->
    <div class="container mx-auto px-4 py-8">
        <div class="mb-8 flex flex-col sm:flex-row gap-4">
            <input type="text" name="location" placeholder="Buscar por ubicación..." class="contact-input w-full sm:w-1/3 px-4 py-3 border border-gray-300 rounded focus:outline-none text-gray-900">
            <select name="price_range" class="contact-input w-full sm:w-1/4 px-4 py-3 border border-gray-300 rounded focus:outline-none text-gray-900">
                <option value="">Rango de Precios</option>
                <option value="low">Menor a Mayor</option>
                <option value="high">Mayor a Menor</option>
            </select>
            <button class="bg-gradient-to-r from-primary to-amber-400 text-white px-6 py-3 rounded-button font-medium hover:bg-amber-600 transition-colors duration-300 w-full sm:w-auto whitespace-nowrap">
                Filtrar
            </button>
        </div>

        <!-- Listado de Propiedades -->
        {% if properties %}
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
                {% for property in properties %}
                    <a href="{% url 'property_detail' property.id %}" class="card-hover bg-white rounded-lg shadow-xl overflow-hidden transition-transform duration-300 hover:shadow-2xl">
                        <div class="relative w-full h-48">
                            {% if property.related_photos.first %}
                                <img src="{{ property.related_photos.first.image.url }}" alt="{{ property.title }}" class="w-full h-48 object-cover object-center rounded-t-lg" onerror="this.onerror=null; this.src='{% static "images/no-image.jpg" %}';">
                            {% else %}
                                <div class="w-full h-48 bg-gray-200 flex items-center justify-center text-gray-500">Sin Foto</div>
                            {% endif %}
                        </div>
                        <div class="p-6">
                            <h3 class="montserrat text-xl font-bold text-gray-900 mb-2">{{ property.title }}</h3>
                            <p class="text-gray-700 mb-2"><i class="ri-map-pin-line text-primary mr-2"></i>{{ property.location }}</p>
                            <p class="text-gray-900 font-semibold mb-2"><i class="ri-money-dollar-circle-line text-primary mr-2"></i>${{ property.price }} {{ property.currency }}</p>
                            <p class="text-gray-700 text-sm mb-4">{{ property.description|truncatewords:15 }}</p>
                            
                            <div class="flex justify-between items-center text-sm text-gray-500">
                                <span><i class="ri-calendar-line text-primary mr-1"></i>{{ property.created_at|date:'F d, Y' }}</span>
                                <span class="text-primary font-medium">Ver Detalles <i class="ri-arrow-right-line"></i></span>
                            </div>
                        </div>
                    </a>
                {% endfor %}
            </div>
        {% else %}
            <p class="text-center text-2xl text-gray-700 montserrat">No hay propiedades disponibles en este momento.</p>
        {% endif %}
    </div>

    <!-- WhatsApp Button -->
    <a href="https://wa.me/1234567890?text=Hola,%20quiero%20información%20sobre%20sus%20propiedades!" target="_blank" class="whatsapp-btn fixed bottom-6 right-6 w-16 h-16 flex items-center justify-center bg-[#22C55E] text-white rounded-full shadow-lg z-50">
        <i class="ri-whatsapp-line ri-2x"></i>
    </a>
{% endblock %}